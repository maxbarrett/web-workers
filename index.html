<html>
<head>
	<style>
		body { font-family:sans-serif; font-size:14px; }
		button { display:block; margin-bottom:10px; }
		textarea { margin-top:20px; width:300px; height:50px; }
	</style>

</head>

<body>

	<h1>Web worker demo</h1>

	<p>Both buttons invoke identical functions creating 1000mb array.</p>

	<button id="expensive">Expensive operation (blocking)</button>
	<p>Array size: <span id="output1"></span></p>


	<button id="worker">Expensive operation with web worker (non-blocking)</button>
	<p>Array size: <span id="output2"></span></p>

	<textarea>Edit me to test blocking UI...</textarea>

	<script>
		function makeData(){
			//Create 1000mb array, locking the UI
			var uInt8View = new Uint8Array(1024*1024*1000); // 1000mb
			for ( var i = 0; i < uInt8View.length; i++){
				uInt8View[i] = i;
			}
			return uInt8View;
		}

		document.getElementById('expensive').addEventListener('click', function(){
			var start = new Date();
			output1.innerHTML = makeData().byteLength + ', taking ' + (new Date() - start) / 1000 + ' seconds.';
		});

		// If we create the array in the web worker, the UI doesn't lock
		document.getElementById('worker').addEventListener('click', function(){
			var worker = new Worker('./js/webworker.js');
			var start = new Date();
			worker.onmessage = function(e){
				output2.innerHTML = e.data.byteLength + ', taking ' + (new Date() - start) / 1000 + ' seconds.';
			}
		});
	</script>

</body>
</html>